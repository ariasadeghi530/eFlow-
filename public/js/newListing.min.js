let firebaseConfig = { apiKey: "AIzaSyBzgX-ul7zTpGeWsXddZ6IItDw9cRkbnCU", authDomain: "eflow-ca056.firebaseapp.com", databaseURL: "https://eflow-ca056.firebaseio.com", projectId: "eflow-ca056", storageBucket: "eflow-ca056.appspot.com", messagingSenderId: "462392261016", appId: "1:462392261016:web:8a3313fd188f398632d3ed", measurementId: "G-HQ8KKYT6QX" }; firebase.initializeApp(firebaseConfig); let userPostId, bar = $("#js-progressbar"), fileButton = $("#filebutton"); axios.get(`/api/users/getinfo`).then(({ data: a }) => { userPostId = a.id }).catch(a => console.error(a)), $("#postItem").click(a => { a.preventDefault(), axios.post("/api/items", { name: $("#item-name").val(), description: $("#description").val(), category: $("#item-category").val(), condition: $("#item-condition").val(), price: $("#item-price").val(), location: $("#item-location").val(), popularity: 1, userId: userPostId }).then(({ data: a }) => { fileButton.change(b => { let c = b.target.files[0], d = c.name, e = firebase.storage().ref("images/" + c.name), f = e.put(c); f.on(firebase.storage.TaskEvent.STATE_CHANGED, progress = a => { let b = 100 * (a.bytesTransferred / a.totalBytes); bar.value = b }, error = () => { }, complete = () => { f.snapshot.ref.getDownloadURL().then(function (b) { let c = { fileid: d, path: b, contents: "", itemId: a.id }; console.log(c), axios.post("/api/upload", { uploadObj: c }).then(() => { $("#uploadDisplay").html("Image added.") }).catch(a => console.error(a)), console.log("File available at", b) }) }) }) }).catch(a => console.log(a)) }), $("#finish-post").click(() => { window.location.href = "/profile" });
